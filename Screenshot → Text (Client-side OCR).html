<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Screenshot → Text (Client-side OCR)</title>
  <meta name="description" content="Simple client-side Screenshot to Text OCR tool using Tesseract.js v5. Upload or drag-drop images, run OCR, copy or download the extracted text." />
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--muted:#94a3b8;--accent:#06b6d4}
    body{font-family:Inter, Roboto, Arial, sans-serif;background:linear-gradient(180deg,#071029 0%,#07172b 100%);color:#e6eef8;margin:0;padding:24px}
    .container{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px}
    h1{font-size:20px;margin:0}
    p.lead{color:var(--muted);margin:6px 0 18px}
    .card{background:rgba(255,255,255,0.03);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .u-row{display:flex;gap:12px}
    .left{flex:1}
    .right{width:320px}
    .drop{border:2px dashed rgba(255,255,255,0.06);padding:18px;border-radius:10px;text-align:center;cursor:pointer}
    input[type=file]{display:none}
    img.preview{max-width:100%;border-radius:8px;margin-top:12px}
    textarea.output{width:100%;height:260px;padding:12px;border-radius:8px;background:#071229;border:1px solid rgba(255,255,255,0.03);color:#e6eef8;font-family:inherit}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    button{background:var(--accent);border:none;padding:10px 12px;border-radius:8px;color:#012;cursor:pointer}
    button.secondary{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    .progress{height:8px;background:rgba(255,255,255,0.04);border-radius:8px;overflow:hidden;margin-top:8px}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,#06b6d4,#3b82f6);width:0%}
    label.select{display:block;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div style="background:linear-gradient(90deg,#06b6d4,#3b82f6);width:46px;height:46px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#012;font-weight:700">OCR</div>
      <div>
        <h1>Screenshot → Text (Client-side OCR)</h1>
        <p class="lead">Screenshot upload karke turant text hasil karein. Ye tool aapke browser me hi chalata hai — koi server pe upload nahi hota.</p>
      </div>
    </header>

    <div class="card" style="margin-top:16px">
      <div class="u-row">
        <div class="left">
          <label class="drop" id="dropZone">Drag & Drop screenshot yahan, ya <button id="chooseBtn" class="secondary">Choose Image</button>
            <input id="fileInput" type="file" accept="image/*" />
          </label>

          <div id="previewArea"></div>

          <div style="margin-top:12px" class="small">Pre-process options (recommended for screenshots):</div>
          <div class="controls">
            <button id="grayscaleBtn" class="secondary">Grayscale</button>
            <button id="thresholdBtn" class="secondary">Binarize (threshold)</button>
            <button id="rotateBtn" class="secondary">Rotate 90°</button>
            <label class="select">Language:
              <select id="langSelect">
                <option value="eng" selected>English (eng)</option>
                <option value="hin">Hindi (hin)</option>
                <option value="eng+hin">English + Hindi</option>
                <option value="tam">Tamil (tam)</option>
                <option value="mar">Marathi (mar)</option>
              </select>
            </label>
          </div>

          <div style="margin-top:12px">
            <button id="runBtn">Run OCR</button>
            <button id="clearBtn" class="secondary">Clear</button>
            <div class="progress" style="display:none"><i id="progBar"></i></div>
          </div>

        </div>

        <div class="right">
          <div class="small">Extracted Text</div>
          <textarea id="output" class="output" placeholder="Yahan OCR output aayega..."></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="copyBtn">Copy</button>
            <button id="downloadBtn" class="secondary">Download .txt</button>
            <button id="pasteBtn" class="secondary">Paste to Clipboard (simulate paste)</button>
          </div>
          <div style="margin-top:12px" class="small">Tips: Screenshots with clear text, high contrast, and minimal background give best results. Use <strong>Binarize</strong> for low-contrast images.</div>
        </div>
      </div>

      <footer>
        <div>Contact: WhatsApp +91 9258036351 • contact@storedropship.in</div>
      </footer>
    </div>

    <p style="color:var(--muted);margin-top:12px">Built with Tesseract.js v5 — client-side OCR. Works offline inside the browser after model files load.</p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script>
    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('dropZone');
    const previewArea = document.getElementById('previewArea');
    const runBtn = document.getElementById('runBtn');
    const output = document.getElementById('output');
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const clearBtn = document.getElementById('clearBtn');
    const chooseBtn = document.getElementById('chooseBtn');
    const progBar = document.getElementById('progBar');
    const progressWrap = document.querySelector('.progress');
    const grayscaleBtn = document.getElementById('grayscaleBtn');
    const thresholdBtn = document.getElementById('thresholdBtn');
    const rotateBtn = document.getElementById('rotateBtn');
    const langSelect = document.getElementById('langSelect');
    const pasteBtn = document.getElementById('pasteBtn');

    let img = new Image();
    let canvas = document.createElement('canvas');
    let ctx = canvas.getContext('2d');
    let currentFile = null;
    let rotation = 0;

    chooseBtn.addEventListener('click', ()=> fileInput.click());
    dropZone.addEventListener('dragover', e=>{ e.preventDefault(); dropZone.style.opacity=0.8 });
    dropZone.addEventListener('dragleave', e=>{ dropZone.style.opacity=1 });
    dropZone.addEventListener('drop', e=>{ e.preventDefault(); dropZone.style.opacity=1; handleFiles(e.dataTransfer.files) });
    fileInput.addEventListener('change', e=> handleFiles(e.target.files));

    function handleFiles(files){
      if(!files || !files[0]) return;
      const file = files[0];
      if(!file.type.startsWith('image/')) return alert('Please upload an image file.');
      currentFile = file;
      const url = URL.createObjectURL(file);
      img = new Image();
      img.onload = ()=>{
        rotation = 0;
        drawToPreview(img);
      };
      img.src = url;
    }

    function drawToPreview(image){
      const maxW = 700;
      const ratio = Math.min(1, maxW / image.width);
      canvas.width = Math.round(image.width * ratio);
      canvas.height = Math.round(image.height * ratio);
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(image,0,0,canvas.width,canvas.height);
      previewArea.innerHTML = '';
      const im = document.createElement('img');
      im.className = 'preview';
      im.src = canvas.toDataURL('image/png');
      previewArea.appendChild(im);
    }

    function applyGrayscale(){
      const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
      for(let i=0;i<imgData.data.length;i+=4){
        const r=imgData.data[i], g=imgData.data[i+1], b=imgData.data[i+2];
        const v = 0.299*r + 0.587*g + 0.114*b;
        imgData.data[i]=imgData.data[i+1]=imgData.data[i+2]=v;
      }
      ctx.putImageData(imgData,0,0);
      previewArea.querySelector('img').src = canvas.toDataURL();
    }

    function applyThreshold(){
      const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
      for(let i=0;i<imgData.data.length;i+=4){
        const v = 0.299*imgData.data[i] + 0.587*imgData.data[i+1] + 0.114*imgData.data[i+2];
        const t = v>140?255:0;
        imgData.data[i]=imgData.data[i+1]=imgData.data[i+2]=t;
      }
      ctx.putImageData(imgData,0,0);
      previewArea.querySelector('img').src = canvas.toDataURL();
    }

    function rotateCanvas(){
      rotation = (rotation + 90) % 360;
      const w = canvas.width, h = canvas.height;
      const tmp = document.createElement('canvas');
      tmp.width = h; tmp.height = w;
      const tctx = tmp.getContext('2d');
      tctx.translate(tmp.width/2,tmp.height/2);
      tctx.rotate(rotation * Math.PI/180);
      tctx.drawImage(canvas, -w/2, -h/2);
      canvas = tmp; ctx = canvas.getContext('2d');
      previewArea.querySelector('img').src = canvas.toDataURL();
    }

    grayscaleBtn.addEventListener('click', ()=>{ if(!canvas) return; applyGrayscale(); });
    thresholdBtn.addEventListener('click', ()=>{ if(!canvas) return; applyThreshold(); });
    rotateBtn.addEventListener('click', ()=>{ if(!canvas) return; rotateCanvas(); });

    runBtn.addEventListener('click', async ()=>{
      if(!previewArea.querySelector('img')) return alert('Please add an image first');
      output.value = '';
      progressWrap.style.display = 'block'; progBar.style.width = '0%';
      runBtn.disabled = true;
      const lang = langSelect.value || 'eng';
      try{
        const dataUrl = previewArea.querySelector('img').src;
        const res = await fetch(dataUrl);
        const blob = await res.blob();
        const { createWorker } = Tesseract;
        const worker = await createWorker(lang, 1, {
          logger: m => {
            if(m.status === 'recognizing text' && m.progress){
              const pct = Math.round(m.progress*100);
              progBar.style.width = pct + '%';
            }
          }
        });
        const { data: { text } } = await worker.recognize(blob);
        output.value = text;
        await worker.terminate();
      }catch(err){
        console.error(err); alert('OCR failed: ' + (err.message || err));
      }finally{
        runBtn.disabled = false;
        progressWrap.style.display = 'none'; progBar.style.width='0%';
      }
    });

    copyBtn.addEventListener('click', ()=>{
      navigator.clipboard.writeText(output.value).then(()=> alert('Copied to clipboard'))
    });

    downloadBtn.addEventListener('click', ()=>{
      const blob = new Blob([output.value], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'ocr-output.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    clearBtn.addEventListener('click', ()=>{ previewArea.innerHTML=''; output.value=''; currentFile=null; canvas = document.createElement('canvas'); ctx = canvas.getContext('2d'); });

    pasteBtn.addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText(output.value);
        alert('Text copied to clipboard. Ab aap AI textbox me Ctrl+V kar sakte hain.');
      }catch(e){ alert('Clipboard access denied. Please select and copy manually.') }
    });

    previewArea.addEventListener('click', e=>{
      const im = previewArea.querySelector('img'); if(!im) return; window.open(im.src,'_blank');
    });

  </script>
</body>
</html>
