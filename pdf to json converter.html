<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF to JSON Converter — Storedropship</title>
  <meta name="description" content="Convert PDF pages/tables into structured JSON in the browser. Extract selectable text and export as JSON (pages → rows → cells)." />
  <meta name="keywords" content="PDF to JSON, convert PDF to json, extract tables from PDF, pdf.js, client-side PDF converter" />
  <style>
    :root{--bg:#f7fafc;--card:#fff;--muted:#64748b;--accent:#0ea5a4}
    *{box-sizing:border-box;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#eef2ff);padding:18px;color:#0f172a}
    .wrap{max-width:1100px;margin:0 auto}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 8px 30px rgba(10,20,40,0.06);margin-bottom:14px}
    h1{margin:0 0 6px;font-size:20px}
    p.lead{margin:0 0 12px;color:var(--muted)}
    label{display:block;font-size:13px;color:#374151;margin-top:8px}
    input,select,button,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef6;font-size:14px}
    .controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    button.primary{background:var(--accent);color:#fff;border:none;padding:10px;border-radius:8px;cursor:pointer}
    button.alt{background:#fff;border:1px solid #e6eef6;color:#0b5394;padding:10px;border-radius:8px}
    pre{background:#f8fafc;padding:12px;border-radius:8px;border:1px solid #e6e9ef;overflow:auto;max-height:420px;white-space:pre-wrap}
    .meta{font-size:13px;color:var(--muted);margin-top:8px}
    .row{display:grid;grid-template-columns:1fr 420px;gap:12px}
    @media(max-width:900px){.row{grid-template-columns:1fr}}
  </style>
  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
  <!-- Optional: Tesseract.js for OCR (commented by default). Enable if you want scanned PDFs support. -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script> -->
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>PDF to JSON Converter</h1>
      <p class="lead">Extract selectable text from a PDF and export a structured JSON object (pages → rows → cells). Runs entirely in your browser — no uploads. Best for digital PDFs with clear text layout.</p>

      <label for="pdfFile">Choose PDF file</label>
      <input id="pdfFile" type="file" accept="application/pdf" />

      <div class="row">
        <div>
          <label for="strategy">Parsing strategy</label>
          <select id="strategy">
            <option value="auto">Auto-detect (comma / tab / spaces)</option>
            <option value="comma">Comma-separated</option>
            <option value="tab">Tab-delimited</option>
            <option value="spaces">Multiple spaces as delimiter</option>
          </select>

          <label for="pages">Pages to extract (e.g. 1,3-5) — leave empty for all</label>
          <input id="pages" placeholder="1,3-5" />

          <div class="controls">
            <button id="extractBtn" class="primary">Extract & Convert</button>
            <button id="previewBtn" class="alt">Preview Raw Text</button>
            <button id="clearBtn" class="alt">Clear</button>
          </div>

          <div class="meta">Output JSON contains an array of pages. Each page includes rows (reconstructed from text item Y positions) and cells (split by chosen strategy). For scanned PDFs consider using OCR (Tesseract.js).</div>
        </div>

        <div>
          <label>Preview / JSON Output</label>
          <pre id="preview">No output yet.</pre>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="downloadJson" class="alt">Download JSON</button>
            <button id="copyJson" class="alt">Copy JSON</button>
            <button id="openJson" class="alt">Open JSON (new tab)</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px">Description</h2>
      <p style="margin:0;color:#374151;line-height:1.6">This client-side PDF→JSON converter uses PDF.js to read text items and heuristics to group them into rows and cells. It is privacy-friendly (no server uploads) and useful for extracting tables, reports, or structured data from PDF files.</p>
      <ul style="margin-top:8px;color:#374151">
        <li>Client-side conversion — files never leave your browser.</li>
        <li>Parsing strategies: auto, comma, tab, multiple spaces.</li>
        <li>Specify pages to extract and preview JSON before download.</li>
        <li>Limitations: scanned images require OCR (Tesseract.js) for accurate extraction; complex layouts may need manual cleanup.</li>
      </ul>
    </div>
  </div>

  <script>
    const pdfFile = document.getElementById('pdfFile');
    const extractBtn = document.getElementById('extractBtn');
    const previewBtn = document.getElementById('previewBtn');
    const clearBtn = document.getElementById('clearBtn');
    const preview = document.getElementById('preview');
    const strategyEl = document.getElementById('strategy');
    const pagesEl = document.getElementById('pages');
    const downloadJson = document.getElementById('downloadJson');
    const copyJson = document.getElementById('copyJson');
    const openJson = document.getElementById('openJson');

    let lastJson = null;

    function parsePagesInput(str, maxPage){
      if(!str) return null;
      const parts = str.split(',').map(s=>s.trim());
      const pages = new Set();
      parts.forEach(p => {
        if(p.includes('-')){
          const [a,b] = p.split('-').map(Number);
          if(!isNaN(a) && !isNaN(b)) for(let i=a;i<=b;i++) if(i>=1 && i<=maxPage) pages.add(i);
        } else {
          const n = Number(p); if(!isNaN(n) && n>=1 && n<=maxPage) pages.add(n);
        }
      });
      return Array.from(pages).sort((a,b)=>a-b);
    }

    function pageTextItemsToRows(textItems){
      const linesMap = new Map();
      textItems.forEach(it => {
        const y = Math.round((it.transform && it.transform[5]) ? it.transform[5] : (it.ty || 0));
        const key = Math.round(y/3)*3;
        if(!linesMap.has(key)) linesMap.set(key, []);
        linesMap.get(key).push(it);
      });
      const ys = Array.from(linesMap.keys()).sort((a,b)=>b-a);
      const rows = ys.map(y => {
        const arr = linesMap.get(y).sort((a,b)=>{
          const ax = (a.transform && a.transform[4]) ? a.transform[4] : (a.x || 0);
          const bx = (b.transform && b.transform[4]) ? b.transform[4] : (b.x || 0);
          return ax - bx;
        });
        return arr.map(a=>a.str).join(' ').replace(/\s+/g,' ').trim();
      });
      return rows.filter(r=>r);
    }

    function splitRowToCells(row, strategy){
      if(strategy==='comma') return row.split(',');
      if(strategy==='tab') return row.split('\t');
      if(strategy==='spaces') return row.split(/\s{2,}/);
      // auto
      if(row.includes(',')) return row.split(',');
      if(row.includes('\t')) return row.split('\t');
      const multi = row.split(/\s{2,}/);
      if(multi.length>1) return multi;
      return row.split(/\s/);
    }

    async function extractAndConvert(){
      const file = pdfFile.files[0];
      if(!file){ alert('Please choose a PDF file first'); return; }
      preview.textContent = 'Reading PDF...';
      const arrayBuffer = await file.arrayBuffer();
      const loadingTask = pdfjsLib.getDocument({data: arrayBuffer});
      const pdf = await loadingTask.promise;
      const maxPage = pdf.numPages;
      const pagesToUse = parsePagesInput(pagesEl.value, maxPage) || Array.from({length:maxPage},(_,i)=>i+1);

      const strategy = strategyEl.value;
      const result = {fileName: file.name, pages: [] };

      for(const p of pagesToUse){
        preview.textContent = `Extracting page ${p} of ${maxPage}...`;
        const page = await pdf.getPage(p);
        const textContent = await page.getTextContent();
        const rows = pageTextItemsToRows(textContent.items);
        const cells = rows.map(r => splitRowToCells(r, strategy).map(c => c.trim()));
        result.pages.push({page: p, rows: rows.length, data: cells});
      }

      lastJson = result;
      const pretty = JSON.stringify(result, null, 2);
      preview.textContent = pretty.slice(0, 20000) + (pretty.length>20000 ? '\n\n... (truncated)' : '');
    }

    extractBtn.addEventListener('click', async ()=>{
      try{ await extractAndConvert(); }catch(err){ console.error(err); alert('Extraction failed: '+err.message); }
    });

    previewBtn.addEventListener('click', async ()=>{
      const file = pdfFile.files[0];
      if(!file) return alert('Please choose a PDF file first');
      preview.textContent = 'Reading raw PDF text...';
      const arrayBuffer = await file.arrayBuffer();
      const loadingTask = pdfjsLib.getDocument({data: arrayBuffer});
      const pdf = await loadingTask.promise;
      let all = [];
      for(let p=1;p<=pdf.numPages;p++){
        const page = await pdf.getPage(p);
        const tc = await page.getTextContent();
        const rows = pageTextItemsToRows(tc.items);
        all.push({page:p, rows});
      }
      preview.textContent = JSON.stringify(all, null, 2).slice(0,20000) + (JSON.stringify(all).length>20000 ? '\n\n... (truncated)' : '');
    });

    downloadJson.addEventListener('click', ()=>{
      if(!lastJson) return alert('No JSON available. Run Extract & Convert first.');
      const blob = new Blob([JSON.stringify(lastJson,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = fileNameSafe(lastJson.fileName || 'converted') + '.json'; a.click(); URL.revokeObjectURL(url);
    });

    copyJson.addEventListener('click', async ()=>{
      if(!lastJson) return alert('No JSON available. Run Extract & Convert first.');
      try{ await navigator.clipboard.writeText(JSON.stringify(lastJson,null,2)); alert('JSON copied to clipboard'); }catch(e){ alert('Copy failed — allow clipboard access'); }
    });

    openJson.addEventListener('click', ()=>{
      if(!lastJson) return alert('No JSON available. Run Extract & Convert first.');
      const blob = new Blob([JSON.stringify(lastJson,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      window.open(url,'_blank'); setTimeout(()=>URL.revokeObjectURL(url),2000);
    });

    clearBtn.addEventListener('click', ()=>{ pdfFile.value=''; preview.textContent=''; lastJson=null; });

    function fileNameSafe(name){ return name ? name.replace(/\.[^.]+$/, '') : 'converted'; }
  </script>
</body>
</html>
